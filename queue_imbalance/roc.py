import matplotlib.pyplot as plt

import lob

stocks = [
    '11399', '2645', '9069', '9063', '9926', '1472', '9094', '9270', '10166', '9061', '2822',
    '2651', '2051', '1865', '1243', '4060', '1221', '2368', '12456', '12327', '2094', '9064',
    '9034', '2748', '9761', '1956', '12098', '11244', '1113', '10795', '13061', '10887', '11234',
    '9062', '1769', '7858', '4154', '4218', '13003', '9067', '10508', '2057', '12534', '1907',
    '4481', '4549', '4618', '3035', '11867', '4851', '2730', '12713', '3757', '10470', '9265',
    '4799', '11618', '1388', '9086', '9058', '11583', '2050', '2197', '9268', '12552', '9065',
    '2602', '3161', '9074', '4736', '3459', '13113', '2290', '9269', '12059', '3879', '1229',
    '4695', '5836', '10484', '2890', '1694', '1080', '3107', '11038', '12417', '9266', '4320',
    '3022', '3388', '8080', '1431', '12255', '7843', '11714', '4575', '2028', '11946', '2813',
    '11869']

i = 0
rocs_areas = {}
plt.figure()
for s in stocks:
    try:
        print('for', s)
        d, d_test = lob.load_data(s, data_dir='data/INDEX/')

        print('performing regressions', s)
        reg = lob.logistic_regression(d, 0, len(d))

        print('performing predictions', s)
        score = lob.plot_roc(d_test, reg, stock=s)
        rocs_areas[s] = score
        print('{} (area = {})'.format(s, score))
        i += 1
        if i % 10 == 0:
            plt.savefig('plots_{}.png'.format(i))
            plt.figure()
    except Exception as e:
        print('Exception for ', s, e)

plt.savefig('plots_{}.png'.format(i))
print(rocs_areas)

results = {'11399': 0.59151574578931998, '2645': 0.55035670049721375, '9069': 0.54862448368600902,
           '9063': 0.55166193067132985, '9926': 0.56565445046202811, '1472': 0.54752392006309236,
           '9094': 0.56368270627961603, '9270': 0.53861757805266663, '10166': 0.54625242292074916,
           '9061': 0.53419532489299937, '2822': 0.58224352628562492, '2651': 0.57981867856532587,
           '2051': 0.60837501995636201, '1865': 0.58913234616920873, '1243': 0.6018438524262939,
           '4060': 0.5599808164985729, '1221': 0.58926571748520229, '2368': 0.59213906140586248,
           '12456': 0.56268441079599874, '12327': 0.58154569323071115, '2094': 0.57800054938498713,
           '9064': 0.53929251503878373, '9034': 0.58574154038123694, '2748': 0.57368732743473894,
           '9761': 0.56237980343901295, '1956': 0.56262988329001207, '12098': 0.61790199278523472,
           '11244': 0.53858483633079723, '1113': 0.5628529924462522, '10795': 0.62576944768964271,
           '13061': 0.55542753242712406, '10887': 0.54743083003952575,
           '11234': 0.60048892168004919,
           '9062': 0.54436665314144284, '1769': 0.57517386530014636, '7858': 0.5716311993996146,
           '4154': 0.56153916899008671, '4218': 0.596722700767781, '13003': 0.5331436858545292,
           '9067': 0.54398711815204204, '10508': 0.56090189741160734, '2057': 0.59077157602969788,
           '12534': 0.56901981358095943, '1907': 0.57932883648797628, '4481': 0.60454584129390565,
           '4549': 0.55436087482397622, '4618': 0.54780963254152271, '3035': 0.56196295036586685,
           '11867': 0.55664518452292255, '4851': 0.59213163579655115, '2730': 0.57860277635239143,
           '12713': 0.57932573511945662, '3757': 0.58241670141818525, '10470': 0.56818421416159537,
           '9265': 0.54994112361138803, '4799': 0.55448760575962708, '11618': 0.61166374383336797,
           '1388': 0.56029683860715862, '9086': 0.54762685345548778, '9058': 0.52610579035847072,
           '11583': 0.55962630049409123, '2050': 0.57757944827740559, '2197': 0.58800455211951008,
           '9268': 0.56580851316414293, '12552': 0.55998904534488703, '9065': 0.55288013175387418,
           '2602': 0.55618891820923033, '3161': 0.55903789422214989, '9074': 0.53516662102794277,
           '4736': 0.58670664063607125, '3459': 0.59080103245486681, '13113': 0.59180646561932571,
           '2290': 0.58258392171435658, '9269': 0.54542427116971559, '12059': 0.55289486499998708,
           '3879': 0.56591121672063516, '1229': 0.59941124737382123, '5836': 0.56272117059809712,
           '10484': 0.56251664914125477, '2890': 0.55944797923090184, '1694': 0.56584698724448956,
           '1080': 0.59652652029305331, '3107': 0.60206213046428225, '11038': 0.57951653944020354,
           '12417': 0.56201586952192273, '9266': 0.54168819846964822, '4320': 0.58417996266985706,
           '3022': 0.56528686323981958, '3388': 0.59478589767100676, '8080': 0.5598437890556025,
           '1431': 0.56817654344148327, '12255': 0.56970940434392425, '11714': 0.58230913027169839,
           '4575': 0.58784334332894983, '2028': 0.59395415778019822, '11946': 0.58835047144428065,
           '2813': 0.54583750207740089, '11869': 0.57356726730795282}
